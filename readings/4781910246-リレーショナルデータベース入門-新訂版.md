# 『リレーショナルデータベース入門［新訂版］−データモデル・SQL・管理システム−』読書メモ

## 第1章 データベースとは何か

### 演習問題 解答

#### 問題1

##### 概念モデル

- 実世界のデータ構造とその制約をアクセプタ（設計者やなんらかの機械）が解釈して、ある記号系（ER図など）で記述したもの

##### 論理モデル

- なんらかのDBMSで取り扱い可能な表現
- つまり、概念モデルをより具体的な実際にシステムとして動かすものに近づけたモデル

#### 問題2

##### ネットワークモデル

- レコード間の関係がポインタでつながった網の目構造をなしている

##### ハイアラキカルモデル

- 一対多関係が親子レコード階層として表され、ポインタでつながっている

##### リレーショナルモデル

- ポインタのような具体的なデータ間の関係を使用せず、フォーマルなリレーション（表）だけでデータモデルを表現する

##### オブジェクト指向

- オブジェクトのコンポジションをデータモデルとして表現している

#### 問題3

店舗 (`shops`)、顧客 (`customer`)、商品 (`products`)、注文 (`orders`) を例として考える。

##### （問1）

3項関連型を用いた実体−関連図。`*` 付きの属性が主キーである。

```
                                  (payment)
                                    |
(*email, address)-[customers] -L- <orders> -M- [products]-(*sku, price)
                                    |
                                    N
                                    |
                                  [shops]-(*shop_name, address)
```

##### （問2）

- 実体型はそのままリレーションへ変換する
- 関連型は多対多のとき関連する実体の主キーと関連型の属性を合わせたリレーションへ変換する

##### （問3）

![リレーショナルデータベーススキーマ](./images/4-7819-1024-6/ch1-schema.png)

##### （問4）

次の理由から第6正規形になっている。

- 部分関数従属がない
- 推移関数従属がない
- 非キーから主キーの部分集合への従属がない
- 主キーだけからなるリレーションがない

#### 問題4

##### ID関連型をリレーショナルデータベーススキーマへ変換する方法

- 弱実体型にID関連型の主キーを持たせ、主キーから部分キーを除いたものを所有実体型への外部キーとする

##### ISA関連をリレーショナルデータベーススキーマへ変換する方法

- いくつか方法がある
  - 親の実体の属性を子の実体に持たせてリレーションに変換し、親の実体はリレーションに変換しない
  - それぞれの実体をリレーションに変換する

#### 問題5

##### ファイル管理

- ファイルはレコードの集合であり、プログラム中で利用されることを前提としている。そこに統一的な管理は存在しないので、データの一貫性欠如や重複が起きうる

##### データベース管理

- DBMSで統一的にデータを管理するものであり、一貫性／アクセス権限／機密保護の保証が可能な、組織体における共通資源である

#### 問題6

店舗の運営で生じるデータ（原価、売上、データの生成日時など）を例として考える。

**データ**は仕入や販売を通じて生まれた数値の羅列である。そこから、どの時間にいくら利益が生じているかを見出すことで、どの時間にどの商品が売れやすい、という知識を増やすことができる**情報**を得られる。

## 第2章 リレーショナルデータモデル

### 演習問題 解答

#### 問題1

候補キーはタップルを一意に識別できる属性の極小な組であり、あるリレーションに少なくとも1個以上存在する。一方、主キーは候補キーの中からもっとも意味があると設計者が考えて選んだキーであり、キー制約（一意性制約、非NULL制約）を課す。

キー制約はある主キーの値集合が必ず存在し（非NULL制約）、一意に識別できること（一意性制約）を保証する制約。外部キー制約はあるリレーションのある属性と同じ値の属性を持つタップルが別リレーションの主キーに必ず存在することを保証する制約。

#### 問題2

まず、リレーションとは「ドメインの直積の部分集合」であることから、各タップルは必ず異なる属性値の組となる。このとき、全属性のうち一部からなる組が候補キーにならない場合でも、全属性からなる組は必ずそのタップルを一意に特定できる候補キーとなるので、リレーションスキーマに候補キーが存在しないことはない。

#### 問題3

「配送」を表す次のリレーションスキーマは全属性の組が候補キー、すなわち主キーとなる：

```
配送 (配送業者, 配送先, 受取人名, 日時, 商品)
```

理由はほぼ自明だが、配送先だけでは複数人がその配送先に居住している可能性があるので、受取人名もキーとする必要がある点に注意。

#### 問題4

空集合への `SUM`, `AVG` の適用時に現れるNULLは値が0であることを意味している。

#### 問題5

第1章演習問題3(問3)の解答から少し変えている。

```
CREATE SCHEMA 店舗販売;
CREATE DOMAIN SKU型 NCHAR(10);
CREATE TABLE 店舗 (
  店舗名 NCHAR VARYING (50) NOT NULL,
  住所 NCHAR VARYING (100) NOT NULL,
  PRIMARY KEY (店舗名)
)
CREATE TABLE 商品 (
  SKU SKU型 NOT NULL,
  値段 INTEGER NOT NULL,
  在庫 INTEGER NOT NULL,
  PRIMARY KEY (SKU)
)
CREATE TABLE 顧客 (
  メールアドレス NCHAR(256) NOT NULL,
  住所 NCHAR(256) NOT NULL,
  PRIMARY KEY (メールアドレス)
)
CREATE TABLE 注文 (
  店舗名 NCHAR VARYING (50) NOT NULL,
  SKU SKU型 NOT NULL,
  メールアドレス NCHAR(256) NOT NULL,
  決済方法 NCHAR(50) NOT NULL,
  総額 INTEGER NOT NULL,
  購入日時 DATETIME NOT NULL,
  PRIMARY KEY (店舗名, SKU, メールアドレス, 購入日時),
  FOREIGN KEY (店舗名) REFERENCES 店舗(店舗名),
  FOREIGN KEY (SKU) REFERENCES 商品(SKU),
  FOREIGN KEY (メールアドレス) REFERENCES 顧客(メールアドレス)
)
```

#### 問題6

##### (問1)

問題5のスキーマにおいて、次の一貫性制約は検査制約によって定義できる。

- `商品` の `総額` は0以上の金額を表す
- `注文` の `決済方法` は定められた方法だけを持つ

SQL-92を使った定義を次に示す。

```
CREATE TABLE 商品 (
  SKU SKU型 NOT NULL,
  値段 INTEGER NOT NULL,
  在庫 INTEGER NOT NULL,
  PRIMARY KEY (SKU),
  CHECK (値段 ≧ 0);
);
CREATE TABLE 注文 (
  // ...
  決済方法 NCHAR(50) NOT NULL,
  // ...
  CHECK (決済方法 IN ('クレジットカード', '銀行振込', '代金引換'));
);
```

##### (問2)

問題5のスキーマにおいて、`注文` の `総額` が注文した個々の商品の金額の総和に一致している、という一貫性制約は表明によって定義できる。

##### (問3)

`注文` にタップルが挿入されたときに対応する `商品` のタップルの `在庫` が減少する、という一貫性制約はトリガによって定義できる。SQL-92を使った定義を次に示す。

```
CREATE TRIGGER 在庫引当
  AFTER INSERT ON 注文
    UPDATE 商品
      SET 在庫 = 在庫 - 1
      WHERE 商品.SKU = 注文.SKU;
```

#### 問題7

- あるリレーションに対する操作（挿入、更新、削除、選択、参照）やあるスキーマに対する操作（テーブル作成、ビュー作成、更新、削除、SELECT発行）をリレーション、ビューさらにはある列を対象にして権限を管理できる
- 権限の付与は連鎖できる。`WITH OPTION` を `GRANT` 文の末尾につけることで、権限が与えられたユーザは別のユーザにその権限を移譲できる。権限の剥奪も `ON CASCADE` で連鎖する
